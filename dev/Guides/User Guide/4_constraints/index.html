<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Macro Constraint Library · Macro</title><meta name="title" content="Macro Constraint Library · Macro"/><meta property="og:title" content="Macro Constraint Library · Macro"/><meta property="twitter:title" content="Macro Constraint Library · Macro"/><meta name="description" content="Documentation for Macro."/><meta property="og:description" content="Documentation for Macro."/><meta property="twitter:description" content="Documentation for Macro."/><meta property="og:url" content="https://macroenergy.github.io/Macro/stable/Guides/User Guide/4_constraints/"/><meta property="twitter:url" content="https://macroenergy.github.io/Macro/stable/Guides/User Guide/4_constraints/"/><link rel="canonical" href="https://macroenergy.github.io/Macro/stable/Guides/User Guide/4_constraints/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Macro</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">Welcome to Macro</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../">Introduction</a></li><li><a class="tocitem" href="../../../table_of_contents/">Table of contents</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting Started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Getting Started/1_overview/">Overview</a></li><li><a class="tocitem" href="../../../Getting Started/2_installation/">Installation</a></li><li><a class="tocitem" href="../../../Getting Started/4_macro_repo_contents/">What&#39;s Included With Macro</a></li><li><a class="tocitem" href="../../../Getting Started/3_first_run/">First Run</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Tutorials/tutorials_introduction/">Introduction</a></li><li><a class="tocitem" href="../../../Tutorials/0_getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../../Tutorials/1_running_macro/">Running Macro</a></li><li><a class="tocitem" href="../../../Tutorials/2_multisector_modelling/">Multisector Modelling</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../guides_introduction/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">User Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../user_build_system/">Create a System</a></li><li><a class="tocitem" href="../user_add_commodity/">Adding Commodities</a></li><li><a class="tocitem" href="../user_add_node/">Adding Nodes</a></li><li><a class="tocitem" href="../user_add_location/">Adding Locations</a></li><li><a class="tocitem" href="../user_add_asset/">Adding Assets</a></li><li><a class="tocitem" href="../user_policy_constraints/">Adding Policy constraints</a></li><li><a class="tocitem" href="../user_asset_constraints/">Adding Assets constraints</a></li><li><a class="tocitem" href="../user_settings/">Configuring Settings</a></li><li><a class="tocitem" href="../user_run_model/">Running Models</a></li><li><a class="tocitem" href="../user_write_results/">Writing Results</a></li><li><a class="tocitem" href="../user_multiperiod/">Using Multi-Period Models</a></li><li><a class="tocitem" href="../user_using_asset_libary/">Exploring the Asset library</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Modeler Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Modeler Guide/modeler_introduction/">Introduction</a></li><li><a class="tocitem" href="../../Modeler Guide/modeler_es_graph/">Energy System Graph-Based Representation</a></li><li><a class="tocitem" href="../../Modeler Guide/modeler_build_sectors/">Creating a New Sector</a></li><li><a class="tocitem" href="../../Modeler Guide/modeler_build_asset/">Creating a New Asset</a></li><li><a class="tocitem" href="../../Modeler Guide/modeler_create_example_case/">Creating a New Example Case</a></li><li><a class="tocitem" href="../../Modeler Guide/modeler_workflow/">Suggested Development Workflow</a></li><li><a class="tocitem" href="../../Modeler Guide/modeler_debugging_testing/">Debugging and Testing Tips</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Developer Guide</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Developer Guide/dev_create_constraint/">Creating a Constraint</a></li><li><a class="tocitem" href="../../Developer Guide/2_type_hierarchy/">Type Hierarchy</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Manual/manual_introduction/">Introduction</a></li><li><a class="tocitem" href="../../../Manual/Inputs/">Inputs</a></li><li><a class="tocitem" href="../../../Manual/Outputs/">Outputs</a></li><li><a class="tocitem" href="../../../Manual/System/">System</a></li><li><a class="tocitem" href="../../../Manual/Sectors/">Sectors</a></li><li><a class="tocitem" href="../../../Manual/Edges/">Edges</a></li><li><a class="tocitem" href="../../../Manual/Nodes/">Nodes</a></li><li><a class="tocitem" href="../../../Manual/Storage/">Storage</a></li><li><a class="tocitem" href="../../../Manual/Transforms/">Transforms</a></li><li><a class="tocitem" href="../../../Manual/Locations/">Locations</a></li><li><a class="tocitem" href="../../../Manual/assets/1_introduction/">Assets</a></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Asset Library</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Manual/assets/battery/">Battery</a></li><li><a class="tocitem" href="../../../Manual/assets/beccselectricity/">BECCS Electricity</a></li><li><a class="tocitem" href="../../../Manual/assets/beccshydrogen/">BECCS Hydrogen</a></li><li><a class="tocitem" href="../../../Manual/assets/electricdac/">Electric DAC</a></li><li><a class="tocitem" href="../../../Manual/assets/electrolyzer/">Electrolyzer</a></li><li><a class="tocitem" href="../../../Manual/assets/fuelcell/">Fuel Cell</a></li><li><a class="tocitem" href="../../../Manual/assets/gasstorage/">Gas Storage</a></li><li><a class="tocitem" href="../../../Manual/assets/hydrogenline/">Hydrogen Line</a></li><li><a class="tocitem" href="../../../Manual/assets/hydropower/">Hydro Reservoir</a></li><li><a class="tocitem" href="../../../Manual/assets/mustrun/">Must Run</a></li><li><a class="tocitem" href="../../../Manual/assets/natgasdaq/">Natural Gas DAC</a></li><li><a class="tocitem" href="../../../Manual/assets/transmissionlink/">Transmission Link</a></li><li><a class="tocitem" href="../../../Manual/assets/thermalhydrogen/">Thermal Hydrogen Plant (with and without CCS)</a></li><li><a class="tocitem" href="../../../Manual/assets/thermalpower/">Thermal Power Plant (with and without CCS)</a></li><li><a class="tocitem" href="../../../Manual/assets/vre/">Variable Renewable Energy resources (VRE)</a></li></ul></li><li><a class="tocitem" href="../../../Manual/Model/">Model</a></li></ul></li><li><a class="tocitem" href="../../../how_to_contribute/">How to contribute</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">References</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../References/1_introduction/">Introduction</a></li><li><a class="tocitem" href="../../../References/2_reading_input/">Reading input data</a></li><li><a class="tocitem" href="../../../References/3_macro_objects/">Macro Objects</a></li><li><a class="tocitem" href="../../../References/4_writing_output/">Writing output data</a></li><li><a class="tocitem" href="../../../References/5_utilities/">Utilities</a></li><li><a class="tocitem" href="../../../References/ref_download_examples/">Downloading examples</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Macro Constraint Library</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Macro Constraint Library</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/macroenergy/MacroEnergy.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/macroenergy/MacroEnergy.jl/blob/main/docs/src/Guides/User Guide/4_constraints.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Macro-Constraint-Library"><a class="docs-heading-anchor" href="#Macro-Constraint-Library">Macro Constraint Library</a><a id="Macro-Constraint-Library-1"></a><a class="docs-heading-anchor-permalink" href="#Macro-Constraint-Library" title="Permalink"></a></h1><p>Currently, Macro includes the following constraints:</p><h2 id="balance_constraint_ref"><a class="docs-heading-anchor" href="#balance_constraint_ref">Balance constraint</a><a id="balance_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#balance_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{BalanceConstraint, MacroEnergy.AbstractVertex, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{BalanceConstraint, MacroEnergy.AbstractVertex, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::BalanceConstraint, v::AbstractVertex, model::Model)</code></pre><p>Add a balance constraint to the vertex <code>v</code>. </p><ul><li>If <code>v</code> is a <code>Node</code>, a demand balance constraint is added. </li><li>If <code>v</code> is a <code>Transformation</code>, this constraint ensures that the stoichiometric equations linking the input and output flows are correctly balanced.</li></ul><p class="math-container">\[\begin{aligned}
    \sum_{\substack{i\  \in \ \text{balance\_eqs\_ids(v)}, \\ t\  \in \ \text{time\_interval(v)}} } \text{balance\_eq(v, i, t)} = 0.0
\end{aligned}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/balance.jl#L7-L20">source</a></section></article><h2 id="capacity_constraint_ref"><a class="docs-heading-anchor" href="#capacity_constraint_ref">Capacity constraint</a><a id="capacity_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#capacity_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{CapacityConstraint, Edge, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{CapacityConstraint, Edge, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::CapacityConstraint, e::Edge, model::Model)</code></pre><p>Add a capacity constraint to the edge <code>e</code>. If the edge is unidirectional, the functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t)} \leq \text{availability(e, t)} \times \text{capacity(e)}
\end{aligned}\]</p><p>If the edge is bidirectional, the constraint is:</p><p class="math-container">\[\begin{aligned}
    i \times \text{flow(e, t)} \leq \text{availability(e, t)} \times \text{capacity(e)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code> and each <code>i</code> in <code>{0, 1}</code>. The function <code>availability</code> returns the time series of the capacity factor of the edge at time <code>t</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/capacity.jl#L7-L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{CapacityConstraint, EdgeWithUC, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{CapacityConstraint, EdgeWithUC, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::CapacityConstraint, e::EdgeWithUC, model::Model)</code></pre><p>Add a capacity constraint to the edge <code>e</code> with unit commitment. If the edge is unidirectional, the functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \sum_{t \in \text{time\_interval(e)}} \text{flow(e, t)} \leq \text{availability(e, t)} \times \text{capacity(e)} \times \text{ucommit(e, t)}
\end{aligned}\]</p><p>If the edge is bidirectional, the constraint is:</p><p class="math-container">\[\begin{aligned}
    i \times \text{flow(e, t)} \leq \text{availability(e, t)} \times \text{capacity(e)} \times \text{ucommit(e, t)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code> and each <code>i</code> in <code>[-1, 1]</code>. The function <code>availability</code> returns the time series of the availability of the edge at time <code>t</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/capacity.jl#L49-L68">source</a></section></article><h2 id="co2_capacity_constraint_ref"><a class="docs-heading-anchor" href="#co2_capacity_constraint_ref">CO2 capacity constraint</a><a id="co2_capacity_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#co2_capacity_constraint_ref" title="Permalink"></a></h2><p>The CO2 capacity constraint is used to limit the amount of CO2 that can be emitted by a single CO2 node.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{CO2CapConstraint, Node{CO2}, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{CO2CapConstraint, Node{CO2}, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::CO2CapConstraint, n::Node{CO2}, model::Model)</code></pre><p>Constraint the CO2 emissions of CO2 on a CO2 node <code>n</code> to be less than or equal to the value of the <code>rhs_policy</code> for the <code>CO2CapConstraint</code> constraint type. If the <code>price_unmet_policy</code> is also specified, then a slack variable is added to the constraint to allow for the CO2 emissions to exceed the value of the <code>rhs_policy</code> by the amount specified in the <code>price_unmet_policy</code> for the <code>CO2CapConstraint</code> constraint type. Please check the example case in the <code>ExampleSystems</code> folder of Macro, or the <a href="../2_input_data/#Macro-Input-Data">Macro Input Data</a> section of the documentation for more information on how to specify the <code>rhs_policy</code> and <code>price_unmet_policy</code> for the <code>CO2CapConstraint</code> constraint type.</p><p>Therefore, the functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \sum_{t \in \text{time\_interval(n)}} \text{emissions(n, t)} - \text{price\_unmet\_policy(n)} \times \text{slack(n)} \leq \text{rhs\_policy(n)}
\end{aligned}\]</p><p>&quot;Emissions&quot; in the above equation is the net balance of CO2 flows into and out of the CO2 node <code>n</code>.</p><div class="admonition is-info" id="Enabling-CO2-emissions-for-an-asset-42cf12650e466b64"><header class="admonition-header">Enabling CO2 emissions for an asset<a class="admonition-anchor" href="#Enabling-CO2-emissions-for-an-asset-42cf12650e466b64" title="Permalink"></a></header><div class="admonition-body"><p><strong>For modelers</strong>: To allow for an asset to contribute to the CO2 emissions of a CO2 node, the asset must have an &quot;emissions&quot; key in its <code>balance_data</code> dictionary. The value of this key should be the <code>emission_rate</code> of the asset.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/co2_cap.jl#L7-L25">source</a></section></article><h2 id="long_duration_storage_constraints_ref"><a class="docs-heading-anchor" href="#long_duration_storage_constraints_ref">Long-duration storage constraints</a><a id="long_duration_storage_constraints_ref-1"></a><a class="docs-heading-anchor-permalink" href="#long_duration_storage_constraints_ref" title="Permalink"></a></h2><p>These additional constraints (and variables) can be used to ensure that storage levels of long-duration storage systems do not exceed installed capacity over non-representative subperiods. </p><p>For a complete description of the constraints, see the paper: &quot;Improved formulation for long-duration storage in capacity expansion models using representative periods&quot;, Federico Parolin, Paolo Colbertaldo, Ruaridh Macdonald, 2024, <a href="https://doi.org/10.48550/arXiv.2409.19079">https://doi.org/10.48550/arXiv.2409.19079</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{LongDurationStorageImplicitMinMaxConstraint, LongDurationStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{LongDurationStorageImplicitMinMaxConstraint, LongDurationStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::LongDurationStorageImplicitMinMaxConstraint, g::LongDurationStorage, model::Model)</code></pre><p>Adds constraints to ensure that the storage levels of long-duration storage systems do not exceed installed capacity over non-representative subperiods.</p><p>The functional form of the two constraints are:</p><p class="math-container">\[\begin{aligned}
    \text{storage\_balance(p)} + \text{max\_storage\_level(r)} - \text{storage\_level(tstart(p))} &amp;\leq \text{capacity(g)} \\
    \text{storage\_balance(p)} + \ \text{min\_storage\_level(r)} - \text{storage\_level(tstart(p))} &amp;\geq 0
\end{aligned}\]</p><p>where:</p><ul><li><code>p</code> is a non-representative subperiod.</li><li><code>r</code> is the representative subperiod used to model <code>p</code>.</li><li><code>tstart(p)</code> is the first timestep of the representative subperiod <code>r</code> used to model the non-representative subperiod <code>p</code>.</li><li><code>storage_balance(p)</code> is the balance of the storage resource at the non-representative subperiod <code>p</code> and is defined as </li></ul><p class="math-container">\[\begin{aligned}
    \text{storage\_balance(p)} = (1 - \text{loss\_fraction}) \times \text{storage\_initial(p)} + \frac{\text{flow(discharge\_edge, tstart(p))}}{\text{efficiency(discharge\_edge)}} - \text{efficiency(charge\_edge)} \times \text{flow(charge\_edge, tstart(p))}
\end{aligned}\]</p><ul><li><code>max_storage_level(r)</code> and <code>min_storage_level(r)</code> are the maximum and minimum storage levels for the representative subperiod <code>r</code>, respectively. These are used to constrain the storage levels as follows:</li></ul><p class="math-container">\[\begin{aligned}
    \text{min\_storage\_level(t&#39;)} \leq \text{storage\_level(t)} \leq \text{max\_storage\_level(t&#39;)}
\end{aligned}\]</p><p>for each time <code>t</code> in the time interval of the storage resource <code>g</code>. <code>t&#39;</code> is the corresponding time in the representative subperiod <code>r</code> used to model the time interval of the storage resource <code>g</code>.</p><div class="admonition is-warning" id="Only-applies-to-long-duration-energy-storage-1c9361cce8d6976d"><header class="admonition-header">Only applies to long duration energy storage<a class="admonition-anchor" href="#Only-applies-to-long-duration-energy-storage-1c9361cce8d6976d" title="Permalink"></a></header><div class="admonition-body"><p>This constraint only applies to long duration energy storage resources. To model a storage technology as long duration energy storage, the user must set <code>long_duration = true</code> in the <code>Storage</code> component of the asset in the <code>.json</code> file. Check the the file <code>hydropower.json</code> in the <code>ExampleSystems/eastern_us_three_zones</code> folder for an example of how to model a long duration energy storage resource.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/long_duration_storage_implicit_min_max.jl#L14-L51">source</a></section></article><h2 id="max_capacity_constraint_ref"><a class="docs-heading-anchor" href="#max_capacity_constraint_ref">Maximum capacity constraint</a><a id="max_capacity_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#max_capacity_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MaxCapacityConstraint, Union{AbstractEdge, AbstractStorage}, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MaxCapacityConstraint, Union{AbstractEdge, AbstractStorage}, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MaxCapacityConstraint, y::Union{AbstractEdge,AbstractStorage}, model::Model)</code></pre><p>Add a max capacity constraint to the edge or storage <code>y</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{capacity(y)} \leq \text{max\_capacity(y)}
\end{aligned}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/max_capacity.jl#L8-L18">source</a></section></article><h2 id="max_non_served_demand_constraint_ref"><a class="docs-heading-anchor" href="#max_non_served_demand_constraint_ref">Maximum non-served demand constraint</a><a id="max_non_served_demand_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#max_non_served_demand_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MaxNonServedDemandConstraint, Node, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MaxNonServedDemandConstraint, Node, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MaxNonServedDemandConstraint, n::Node, model::Model)</code></pre><p>Add a max non-served demand constraint to the node <code>n</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \sum_{s\ \in\ \text{segments\_nsd(n)}} \text{non\_served\_demand(n, s, t)} \leq \text{demand(n, t)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(n)</code> for the node <code>n</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/max_non_served_demand.jl#L7-L18">source</a></section></article><h2 id="max_non_served_demand_per_segment_constraint_ref"><a class="docs-heading-anchor" href="#max_non_served_demand_per_segment_constraint_ref">Maximum non-served demand per segment constraint</a><a id="max_non_served_demand_per_segment_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#max_non_served_demand_per_segment_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MaxNonServedDemandPerSegmentConstraint, Node, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MaxNonServedDemandPerSegmentConstraint, Node, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(
    ct::MaxNonServedDemandPerSegmentConstraint,
    n::Node,
    model::Model,
)</code></pre><p>Add a max non-served demand per segment constraint to the node <code>n</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{non\_served\_demand(n, s, t)} \leq \text{max\_non\_served\_demand(n, s)} \times \text{demand(n, t)}
\end{aligned}\]</p><p>for each segment <code>s</code> in <code>segments_non_served_demand(n)</code> and each time <code>t</code> in <code>time_interval(n)</code> for the node <code>n</code>. The function <code>segments_non_served_demand</code> returns the segments of the non-served demand of the node <code>n</code> as defined in the input data <code>nodes.json</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/max_non_served_demand_per_segment.jl#L7-L22">source</a></section></article><h2 id="max_storage_level_constraint_ref"><a class="docs-heading-anchor" href="#max_storage_level_constraint_ref">Maximum storage level constraint</a><a id="max_storage_level_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#max_storage_level_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MaxStorageLevelConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MaxStorageLevelConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MaxStorageLevelConstraint, g::AbstractStorage, model::Model)</code></pre><p>Add a max storage level constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{storage\_level(g, t)} \leq \text{max\_storage\_level(g)} \times \text{capacity(g)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(g)</code> for the storage <code>g</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/max_storage_level.jl#L7-L18">source</a></section></article><h2 id="min_capacity_constraint_ref"><a class="docs-heading-anchor" href="#min_capacity_constraint_ref">Minimum capacity constraint</a><a id="min_capacity_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#min_capacity_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinCapacityConstraint, Union{AbstractEdge, AbstractStorage}, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinCapacityConstraint, Union{AbstractEdge, AbstractStorage}, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinCapacityConstraint, y::Union{AbstractEdge,AbstractStorage}, model::Model)</code></pre><p>Add a min capacity constraint to the edge or storage <code>y</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{capacity(y)} \geq \text{min\_capacity(y)}
\end{aligned}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_capacity.jl#L7-L17">source</a></section></article><h2 id="min_flow_constraint_ref"><a class="docs-heading-anchor" href="#min_flow_constraint_ref">Minimum flow constraint</a><a id="min_flow_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#min_flow_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinFlowConstraint, Edge, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinFlowConstraint, Edge, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinFlowConstraint, e::Edge, model::Model)</code></pre><p>Add a min flow constraint to the edge <code>e</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t)} \geq \text{min\_flow\_fraction(e)} \times \text{capacity(e)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>. </p><div class="admonition is-info" id="Note-7cfd0aa49789019"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-7cfd0aa49789019" title="Permalink"></a></header><div class="admonition-body"><p>This constraint is available only for unidirectional edges.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_flow.jl#L7-L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinFlowConstraint, EdgeWithUC, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinFlowConstraint, EdgeWithUC, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinFlowConstraint, e::EdgeWithUC, model::Model)</code></pre><p>Add a min flow constraint to the edge <code>e</code> with unit commitment. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t)} \geq \text{min\_flow\_fraction(e)} \times \text{capacity\_size(e)} \times \text{ucommit(e, t)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>.</p><div class="admonition is-info" id="Note-7cfd0aa49789019"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-7cfd0aa49789019" title="Permalink"></a></header><div class="admonition-body"><p>This constraint is available only for unidirectional edges.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_flow.jl#L35-L48">source</a></section></article><h2 id="min_storage_level_constraint_ref"><a class="docs-heading-anchor" href="#min_storage_level_constraint_ref">Minimum storage level constraint</a><a id="min_storage_level_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#min_storage_level_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinStorageLevelConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinStorageLevelConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinStorageLevelConstraint, g::AbstractStorage, model::Model)</code></pre><p>Add a min storage level constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{storage\_level(g, t)} \geq \text{min\_storage\_level(g)} \times \text{capacity(g)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(g)</code> for the storage <code>g</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_storage_level.jl#L7-L18">source</a></section></article><h2 id="min_storage_outflow_constraint_ref"><a class="docs-heading-anchor" href="#min_storage_outflow_constraint_ref">Minimum storage outflow constraint</a><a id="min_storage_outflow_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#min_storage_outflow_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinStorageOutflowConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinStorageOutflowConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinStorageOutflowConstraint, g::AbstractStorage, model::Model)</code></pre><p>Add a min storage outflow constraint to the storage <code>g</code> part of a <code>HydroRes</code> asset. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(spillage\_edge, t)} + \text{flow(discharge\_edge, t)} \geq \text{min\_outflow\_fraction(g)} \times \text{capacity(discharge\_edge)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(g)</code> for the storage <code>g</code>.</p><div class="admonition is-warning" id="Only-applies-to-HydroRes-assets-be7ff47bb225febd"><header class="admonition-header">Only applies to HydroRes assets<a class="admonition-anchor" href="#Only-applies-to-HydroRes-assets-be7ff47bb225febd" title="Permalink"></a></header><div class="admonition-body"><p>This constraint only applies to HydroRes assets. It returns a warning if the storage <code>g</code> does not have a spillage edge.  If the discharge edge is the only outflow, you should apply MinFlowConstraint to the discharge edge.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_storage_outflow.jl#L7-L22">source</a></section></article><h2 id="min_up_and_down_time_constraint_ref"><a class="docs-heading-anchor" href="#min_up_and_down_time_constraint_ref">Minimum up and down time constraint</a><a id="min_up_and_down_time_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#min_up_and_down_time_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinUpTimeConstraint, EdgeWithUC, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinUpTimeConstraint, EdgeWithUC, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinUpTimeConstraint, e::EdgeWithUC, model::Model)</code></pre><p>Add a min up time constraint to the edge <code>e</code> with unit commitment. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{ucommit(e, t)} \geq \sum_{h=0}^{\text{min\_up\_time(e)}-1} \text{ustart(e, t-h)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>. The function <a href="../../../References/5_utilities/#timestepbefore"><code>timestepbefore</code></a> is used to perform the time wrapping within the subperiods and get the correct time step before <code>t</code>.</p><div class="admonition is-info" id="Min-up-time-duration-ef19fba2279ce8ab"><header class="admonition-header">Min up time duration<a class="admonition-anchor" href="#Min-up-time-duration-ef19fba2279ce8ab" title="Permalink"></a></header><div class="admonition-body"><p>This constraint will throw an error if the minimum up time is longer than the length of one subperiod.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_up_down_time.jl#L50-L64">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MinDownTimeConstraint, EdgeWithUC, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MinDownTimeConstraint, EdgeWithUC, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MinDownTimeConstraint, e::EdgeWithUC, model::Model)</code></pre><p>Add a min down time constraint to the edge <code>e</code> with unit commitment. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \frac{\text{capacity(e)}}{\text{capacity\_size(e)}} - \text{ucommit(e, t)} \geq \sum_{h=0}^{\text{min\_down\_time(e)}-1} \text{ushut(e, t-h)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>. The function <a href="../../../References/5_utilities/#timestepbefore"><code>timestepbefore</code></a> is used to perform the time wrapping within the subperiods and get the correct time step before <code>t</code>.</p><div class="admonition is-info" id="Min-down-time-duration-a3620f29dada80d9"><header class="admonition-header">Min down time duration<a class="admonition-anchor" href="#Min-down-time-duration-a3620f29dada80d9" title="Permalink"></a></header><div class="admonition-body"><p>This constraint will throw an error if the minimum down time is longer than the length of one subperiod.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/min_up_down_time.jl#L13-L27">source</a></section></article><h2 id="must_run_constraint_ref"><a class="docs-heading-anchor" href="#must_run_constraint_ref">Must-run constraint</a><a id="must_run_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#must_run_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{MustRunConstraint, Edge, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{MustRunConstraint, Edge, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::MustRunConstraint, e::Edge, model::Model)</code></pre><p>Add a must run constraint to the edge <code>e</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t)} = \text{availability(e, t)} \times \text{capacity(e)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>.</p><div class="admonition is-info" id="Must-run-constraint-13e98ef744c44149"><header class="admonition-header">Must run constraint<a class="admonition-anchor" href="#Must-run-constraint-13e98ef744c44149" title="Permalink"></a></header><div class="admonition-body"><p>This constraint is available only for unidirectional edges.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/must_run.jl#L7-L21">source</a></section></article><h2 id="ramping_limits_constraint_ref"><a class="docs-heading-anchor" href="#ramping_limits_constraint_ref">Ramping limits constraint</a><a id="ramping_limits_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#ramping_limits_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{RampingLimitConstraint, Edge, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{RampingLimitConstraint, Edge, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::RampingLimitConstraint, e::Edge, model::Model)</code></pre><p>Add a ramping limit constraint to the edge <code>e</code>. The functional form of the ramping up limit constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t)} - \text{flow(e, t-1)} + \text{regulation\_term(e, t)} + \text{reserves\_term(e, t)} - \text{ramp\_up\_fraction(e)} \times \text{capacity(e)} \leq 0
\end{aligned}\]</p><p>On the other hand, the ramping down limit constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t-1)} - \text{flow(e, t)} + \text{regulation\_term(e, t)} + \text{reserves\_term(e, t)} - \text{ramp\_down\_fraction(e)} \times \text{capacity(e)} \leq 0
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>. The function <a href="../../../References/5_utilities/#timestepbefore"><code>timestepbefore</code></a> is used to perform the time wrapping within the subperiods and get the correct time step before <code>t</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/ramping_limits.jl#L7-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{RampingLimitConstraint, EdgeWithUC, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{RampingLimitConstraint, EdgeWithUC, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::RampingLimitConstraint, e::EdgeWithUC, model::Model)</code></pre><p>Add a ramping limit constraint to the edge <code>e</code> with unit commitment. The functional form of the ramping up limit constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t)} - \text{flow(e, t-1)} + \text{regulation\_term(e, t)} + \text{reserves\_term(e, t)} - \text{ramp\_up\_fraction(e)} \times \text{capacity\_size(e)} \times (\text{ucommit(e, t)} - \text{ustart(e, t)}) + \text{min(availability(e, t), max(min\_flow\_fraction(e), ramp\_up\_fraction(e)))} \times \text{capacity\_size(e)} \times \text{ustart(e, t)} - \text{min\_flow\_fraction(e)} \times \text{capacity\_size(e)} \times \text{ushut(e, t)} \leq 0
\end{aligned}\]</p><p>On the other hand, the ramping down limit constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e, t-1)} - \text{flow(e, t)} + \text{regulation\_term(e, t)} + \text{reserves\_term(e, t)} - \text{ramp\_down\_fraction(e)} \times \text{capacity\_size(e)} \times (\text{ucommit(e, t)} - \text{ustart(e, t)}) - \text{min\_flow\_fraction(e)} \times \text{capacity\_size(e)} \times \text{ustart(e, t)} + \text{min(availability(e, t), max(min\_flow\_fraction(e), ramp\_down\_fraction(e)))} \times \text{capacity\_size(e)} \times \text{ushut(e, t)} \leq 0
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>. The function <a href="../../../References/5_utilities/#timestepbefore"><code>timestepbefore</code></a> is used to perform the time wrapping within the subperiods and get the correct time step before <code>t</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/ramping_limits.jl#L59-L79">source</a></section></article><h2 id="storage_capacity_constraint_ref"><a class="docs-heading-anchor" href="#storage_capacity_constraint_ref">Storage capacity constraint</a><a id="storage_capacity_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#storage_capacity_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{StorageCapacityConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{StorageCapacityConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::StorageCapacityConstraint, g::AbstractStorage, model::Model)</code></pre><p>Add a storage capacity constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{storage\_level(g, t)} \leq \text{capacity(g)}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(g)</code> for the storage <code>g</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/storage_capacity.jl#L7-L18">source</a></section></article><h2 id="storage_discharge_limit_constraint_ref"><a class="docs-heading-anchor" href="#storage_discharge_limit_constraint_ref">Storage discharge limit constraint</a><a id="storage_discharge_limit_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#storage_discharge_limit_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{StorageDischargeLimitConstraint, Edge, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{StorageDischargeLimitConstraint, Edge, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::StorageDischargeLimitConstraint, e::Edge, model::Model)</code></pre><p>Add a storage discharge limit constraint to the edge <code>e</code> if the start vertex of the edge is a storage. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
   \frac{\text{flow(e, t)}}{\text{efficiency(e)}} \leq \text{storage\_level(start\_vertex(e), timestepbefore(t, 1, subperiods(e)))}
\end{aligned}\]</p><p>for each time <code>t</code> in <code>time_interval(e)</code> for the edge <code>e</code>. The function <a href="../../../References/5_utilities/#timestepbefore"><code>timestepbefore</code></a> is used to perform the time wrapping within the subperiods and get the correct time step before <code>t</code>.</p><div class="admonition is-info" id="Storage-discharge-limit-constraint-d1de6d35f0c0f247"><header class="admonition-header">Storage discharge limit constraint<a class="admonition-anchor" href="#Storage-discharge-limit-constraint-d1de6d35f0c0f247" title="Permalink"></a></header><div class="admonition-body"><p>This constraint is only applied to edges with a start vertex that is a storage.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/storage_discharge_limit.jl#L8-L22">source</a></section></article><h2 id="storage_symmetric_capacity_constraint_ref"><a class="docs-heading-anchor" href="#storage_symmetric_capacity_constraint_ref">Storage symmetric capacity constraint</a><a id="storage_symmetric_capacity_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#storage_symmetric_capacity_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{StorageSymmetricCapacityConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{StorageSymmetricCapacityConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(
    ct::StorageSymmetricCapacityConstraint,
    g::AbstractStorage,
    model::Model,
)</code></pre><p>Add a storage symmetric capacity constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{flow(e\_discharge, t)} + \text{flow(e\_charge, t)} \leq \text{capacity(e\_discharge)}
\end{aligned}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/storage_symmetric_capacity.jl#L8-L22">source</a></section></article><h2 id="storage_charge_discharge_ratio_constraint_ref"><a class="docs-heading-anchor" href="#storage_charge_discharge_ratio_constraint_ref">Storage charge discharge ratio constraint</a><a id="storage_charge_discharge_ratio_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#storage_charge_discharge_ratio_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{StorageChargeDischargeRatioConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{StorageChargeDischargeRatioConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(
    ct::StorageChargeDischargeRatioConstraint,
    g::AbstractStorage,
    model::Model,
)</code></pre><p>Add a storage charge discharge ratio constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{charge\_discharge\_ratio(g)} \times \text{capacity(g.discharge\_edge)} = \text{capacity(g.charge\_edge)}
\end{aligned}\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/storage_charge_discharge_ratio.jl#L7-L21">source</a></section></article><h2 id="storage_max_duration_constraint_ref"><a class="docs-heading-anchor" href="#storage_max_duration_constraint_ref">Storage max duration constraint</a><a id="storage_max_duration_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#storage_max_duration_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{StorageMaxDurationConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{StorageMaxDurationConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::StorageMaxDurationConstraint, g::AbstractStorage, model::Model)</code></pre><p>Add a storage max duration constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{capacity(g)} \leq \text{max\_duration(g)} \times \text{capacity(discharge\_edge(g))}
\end{aligned}\]</p><div class="admonition is-info" id="Storage-max-duration-constraint-d456a01aa19298f6"><header class="admonition-header">Storage max duration constraint<a class="admonition-anchor" href="#Storage-max-duration-constraint-d456a01aa19298f6" title="Permalink"></a></header><div class="admonition-body"><p>This constraint is only applied if the maximum duration is greater than 0.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/storage_duration.jl#L7-L20">source</a></section></article><h2 id="storage_min_duration_constraint_ref"><a class="docs-heading-anchor" href="#storage_min_duration_constraint_ref">Storage min duration constraint</a><a id="storage_min_duration_constraint_ref-1"></a><a class="docs-heading-anchor-permalink" href="#storage_min_duration_constraint_ref" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="MacroEnergy.add_model_constraint!-Tuple{StorageMinDurationConstraint, AbstractStorage, Model}" href="#MacroEnergy.add_model_constraint!-Tuple{StorageMinDurationConstraint, AbstractStorage, Model}"><code>MacroEnergy.add_model_constraint!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_model_constraint!(ct::StorageMinDurationConstraint, g::AbstractStorage, model::Model)</code></pre><p>Add a storage min duration constraint to the storage <code>g</code>. The functional form of the constraint is:</p><p class="math-container">\[\begin{aligned}
    \text{capacity(g)} \geq \text{min\_duration(g)} \times \text{capacity(discharge\_edge(g))}
\end{aligned}\]</p><div class="admonition is-info" id="Storage-min-duration-constraint-5a83e7b878865334"><header class="admonition-header">Storage min duration constraint<a class="admonition-anchor" href="#Storage-min-duration-constraint-5a83e7b878865334" title="Permalink"></a></header><div class="admonition-body"><p>This constraint is only applied if the minimum duration is greater than 0.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/macroenergy/MacroEnergy.jl/blob/17b5dec733accc8038a9a8452d22daac0f57f4c5/src/model/constraints/storage_duration.jl#L39-L52">source</a></section></article><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Thursday 19 June 2025 11:36">Thursday 19 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
